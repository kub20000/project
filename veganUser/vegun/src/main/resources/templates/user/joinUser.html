<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì›ê°€ì…</title>
    <link rel="stylesheet" href="/img/style.css">
</head>

<body class="joinUser">
<header>
    <h1>Vegan delight</h1>
    <nav id="mainNav">
        <a th:href="@{/user/index}">Home</a>
        <a th:href="@{/courses}">Courses</a>
        <a th:href="@{/myFridge}">ë‚˜ì˜ ëƒ‰ì¥ê³ </a>
        <a th:href="@{/user/login}" id="loginBtn">Login</a>
        <a th:href="@{/notice}">ê²Œì‹œíŒ</a>
        <a th:href="@{/user/mypage}" class="active"><img th:src="@{/imgs/123.png}" alt="ë§ˆì´í˜ì´ì§€" width="36"></a>
    </nav>
</header>

<main>
    <!-- íšŒì›ê°€ì… í¼ -->
    <form id="entryInfo" th:action="@{/user/joinUser}" method="post">
        <div>
            <label for="entryName">ì„±ëª…</label>
            <input class="joinUser" type="text" name="name" id="entryName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”." required>
        </div>
        <div>
            <label for="userName">ì•„ì´ë””</label>
            <input class="joinUser" type="text" name="username" id="userName" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”." required>
            <button class="joinUser" type="button" id="checkNicknameBtn">ì¤‘ë³µ í™•ì¸</button>
            <p class="msg" id="nicknameMsg"></p>
        </div>
        <div>
            <label for="nickName">ë‹‰ë„¤ì„</label>
            <input class="joinUser" type="text" name="nickname" id="nickName" placeholder="ì‚¬ìš©í•˜ì‹¤ ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”." required>
        </div>
        <div>
            <label for="entryPw">ë¹„ë°€ë²ˆí˜¸</label>
            <input class="joinUser" type="password" name="password" id="entryPw" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”." required>
            <input type="password" name="confirmPw" id="entryPwConfirm" placeholder="í•œ ë²ˆ ë” ì…ë ¥í•˜ì„¸ìš”." required>
            <button class="joinUser" type="button" id="checkPwBtn">ì¼ì¹˜ ì—¬ë¶€ í™•ì¸</button>
            <p class="msg" id="pwMsg"></p>
        </div>
        <div>
            <label for="newbthInfo">ìƒë…„ì›”ì¼</label>
            <input class="joinUser" type="date" name="birthdate" id="newbthInfo" required>
        </div>
        <div>
            <label for="newphoneNum">íœ´ëŒ€ì „í™” ë²ˆí˜¸</label>
            <input class="joinUser" type="tel" id="newphoneNum" name="phone" placeholder="íœ´ëŒ€ì „í™” ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”." required>
            <p class="msg" id="phoneMsg"></p>
        </div>
        <div>
            <label for="newemailInfo">ì´ë©”ì¼ ì •ë³´</label>
            <input class="joinUser" type="email" id="newemailInfo" name="email" placeholder="example@email.com" required>
            <p class="msg" id="emailMsg"></p>
        </div>
        <!--          <div class="role-group">-->
        <!--              <label>íšŒì› ìœ í˜•</label><br>-->
        <!--              <div class="role-options">-->
        <!--                  <label>-->
        <!--                      <input type="radio" name="userRole" value="student" style="width: 20px;">-->
        <!--                      í•™ìŠµì-->
        <!--                  </label>-->
        <!--                  <label>-->
        <!--                      <input type="radio" name="userRole" value="teacher" style="width: 20px;">-->
        <!--                      ê°•ì˜ì-->
        <!--                  </label>-->
        <!--              </div>-->
        <!--          </div>-->
        <button class="joinUser" type="submit">íšŒì›ê°€ì…</button>
    </form>

    <div id="successMsg" style="display:none;">
        <h2>íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
        <p>Vegan delightì— ê°€ì…í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤ ğŸ‰</p>
        <button class="joinUser" onclick="location.href='login.html'">ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™</button>
    </div>

    <script>
        //  âœ… ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸
        document.getElementById("checkNicknameBtn").addEventListener("click", () => {
            const userId = document.getElementById("userName").value.trim();
            const msg = document.getElementById("nicknameMsg");
            if (!userId) {
                msg.textContent = "ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
                msg.style.color = "red";
                return;
            }
            fetch(`/check-nickname?nickname=${encodeURIComponent(userId)}`)
                .then(res => res.json())
                .then(data => {
                    if (data.exists) {
                        msg.textContent = "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.";
                        msg.style.color = "red";
                    } else {
                        msg.textContent = "ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤!";
                        msg.style.color = "green";
                    }
                })
                .catch(err => console.error(err));
        });

        // âœ… ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì—¬ë¶€ í™•ì¸
        document.getElementById("checkPwBtn").addEventListener("click", () => {
            const pw = document.getElementById("entryPw").value;
            const pwConfirm = document.getElementById("entryPwConfirm").value;
            const msg = document.getElementById("pwMsg");
            if (pw && pwConfirm && pw === pwConfirm) {
                msg.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.";
                msg.style.color = "green";
            } else {
                msg.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
                msg.style.color = "red";
            }
        });

        // âœ… ìµœì¢… íšŒì›ê°€ì… ì œì¶œ
        document.getElementById("entryInfo").addEventListener("submit", (e) => {
            // e.preventDefault();

            const name = document.getElementById("entryName").value.trim();
            const userId = document.getElementById("userName").value.trim();
            const nickname = document.getElementById("nickName").value.trim();
            const pw = document.getElementById("entryPw").value;
            const pwConfirm = document.getElementById("entryPwConfirm").value;
            const birth = document.getElementById("newbthInfo").value;
            const phone = document.getElementById("newphoneNum").value.trim();
            const email = document.getElementById("newemailInfo").value.trim();

            // âœ… íšŒì› ìœ í˜• ì²´í¬
            const role = document.querySelector('input[name="userRole"]:checked');

            // ë©”ì‹œì§€ ìš”ì†Œ
            const pwMsg = document.getElementById("pwMsg");
            const phoneMsg = document.getElementById("phoneMsg");
            const emailMsg = document.getElementById("emailMsg");

            // ì´ˆê¸°í™”
            pwMsg.textContent = "";
            phoneMsg.textContent = "";
            emailMsg.textContent = "";

            let valid = true;

            // ë¹„ë°€ë²ˆí˜¸ ê²€ì‚¬
            if (pw !== pwConfirm) {
                pwMsg.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
                pwMsg.style.color = "red";
                valid = false;
            } else if (pw && pwConfirm) {
                const pwRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;
                if (!pwRegex.test(pw)) {
                    pwMsg.textContent = "ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ë©°, ì˜ë¬¸ê³¼ ìˆ«ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.";
                    pwMsg.style.color = "red";
                    valid = false;
                } else {
                    pwMsg.textContent = "ì‚¬ìš© ê°€ëŠ¥í•œ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.";
                    pwMsg.style.color = "green";
                }
            }

            // ì´ë©”ì¼ í˜•ì‹ ê²€ì‚¬
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                emailMsg.textContent = "ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•˜ì„¸ìš”.";
                emailMsg.style.color = "red";
                valid = false;
            } else {
                emailMsg.textContent = "ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë©”ì¼ì…ë‹ˆë‹¤.";
                emailMsg.style.color = "green";
            }

            // ì „í™”ë²ˆí˜¸ ê²€ì‚¬
            const phoneRegex = /^\d{10,11}$/;
            if (!phoneRegex.test(phone)) {
                phoneMsg.textContent = "íœ´ëŒ€ì „í™” ë²ˆí˜¸ëŠ” 10~11ìë¦¬ ìˆ«ìë§Œ ì…ë ¥í•˜ì„¸ìš”.";
                phoneMsg.style.color = "red";
                valid = false;
            } else {
                phoneMsg.textContent = "ì‚¬ìš© ê°€ëŠ¥í•œ ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤.";
                phoneMsg.style.color = "green";
            }

            // ëª¨ë“  ì¡°ê±´ ë§Œì¡± ì‹œ ì™„ë£Œ í™”ë©´ í‘œì‹œ
            if (valid && name && userId && nickname && birth && role) {
                console.log("íšŒì› ìœ í˜•:", role.value); // "student" ë˜ëŠ” "teacher"
                document.getElementById("entryInfo").style.display = "none";
                document.getElementById("successMsg").style.display = "block";
            }
        });
    </script>
</html>