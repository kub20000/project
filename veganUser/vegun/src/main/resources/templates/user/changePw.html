<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>비밀번호 변경</title>
    <link rel="stylesheet" href="/style.css">
</head>

<body class="changePw">
  <main class="form-container">
    <h2 style="align-self: flex-start; color: black;">비밀번호 변경<img src="/vegan/pw.png" alt="비밀번호" width="30"></h2>
    <form id="changePwForm" th:action="@{/user/changePw}" method="post">
      <input class="changePw" type="password" name="nowPw" id="nowPw" placeholder="현재 비밀번호를 입력하세요." required>
      <div style="position: relative;">
        <input type="password" id="newPw" name="password" placeholder="새로운 비밀번호를 입력하세요." required>
        <div id="capsLockWarning" class="caps-warning">Caps Lock이 켜져 있습니다!</div>
        <div id="pwStrength" class="strength"></div>
      </div>
      <input type="password" id="confirmPw" name="confirmPw" placeholder="다시 한 번 입력하세요." required>
        <button type="submit" class="fixInfo">변경</button>
    </form>
  </main>

  <script>
      const form = document.getElementById("changePwForm");
      const newPwInput = document.getElementById("newPw");
      const confirmPwInput = document.getElementById("confirmPw");
      const strengthDiv = document.getElementById("pwStrength");
      const capsLockWarning = document.getElementById("capsLockWarning");

      // Caps Lock 감지
      newPwInput.addEventListener("keyup", (e) => {
          capsLockWarning.style.display = e.getModifierState("CapsLock") ? "block" : "none";
      });

      // 비밀번호 안전도 검증
      newPwInput.addEventListener("input", () => {
          const pwd = newPwInput.value;
          let strength = "약함";
          let color = "red";

          const regexStrong = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/;
          const regexMedium = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{6,}$/;

          if (regexStrong.test(pwd)) {
              strength = "강함";
              color = "green";
          } else if (regexMedium.test(pwd)) {
              strength = "보통";
              color = "orange";
          }

          strengthDiv.textContent = `비밀번호 안전도: ${strength}`;
          strengthDiv.style.color = color;
      });

      // 폼 제출 시 추가 체크
      form.addEventListener("submit", function(e){
          e.preventDefault();
          const newPw = newPwInput.value;
          const confirmPw = confirmPwInput.value;

          if (newPw !== confirmPw) {
              alert("비밀번호가 일치하지 않습니다.");
              return;
          }

          const regexStrong = /^(?=.*[a-z])(?=.*\d)(?=.*[!@#$%^&*+\-=_]).{8,}$/;
          if (!regexStrong.test(newPw)) {
              alert("비밀번호는 최소 8자 이상, 소문자/숫자/특수문자를 포함해야 합니다.");
              return;
          }

          form.submit(); // 조건 통과하면 서버에 POST
      });
  </script>
</body>

</html>